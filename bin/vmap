#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))

require 'io/console'

require 'icfpc2012'

begin
  require "Win32API"

  def read_char
    Win32API.new("crtdll", "_getch", [], "L").Call.chr
  end
rescue LoadError
  def read_char
    system "stty raw -echo"
    STDIN.getc
  ensure
    system "stty -raw echo"
  end
end

def is_valid_input(i)
	i == 'U' || i == 'D' || i == 'L' || i == 'R' ? true : false
end

def read_map
  Icfpc2012::Map.new(File.read('./maps/contest1.map.txt'))
end

def print_map(map)
  map.to_s.each_line { |line| puts line }
end

begin
  map = read_map
  loop do
    print_map(map)
    
    begin
      step = read_char.capitalize
      raise Interrupt if step.chr == "A"
    end until is_valid_input(step)
    puts step

    map = map.step(step)
    
  end
rescue Interrupt
  puts 'Quitting...'
  exit 1
end
